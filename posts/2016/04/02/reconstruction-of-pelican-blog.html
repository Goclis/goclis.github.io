<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Goclis Yao" />
        <meta name="copyright" content="Goclis Yao" />

<meta name="keywords" content="Pelican, Jinja2, Python, " />
        <title>Pelican博客结构改造  · Logging
</title>
        <link href="/theme/css/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="/theme/images/apple-touch-icon-144x144.png" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Logging - Full Atom Feed" />
        <link href="/feeds/Life.atom.xml" type="application/atom+xml" rel="alternate" title="Logging - Life Category Atom Feed" />
        <link href="/feeds/Python.atom.xml" type="application/atom+xml" rel="alternate" title="Logging - Python Category Atom Feed" />
        <link href="/feeds/Tech.atom.xml" type="application/atom+xml" rel="alternate" title="Logging - Tech Category Atom Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>Logging</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="/">Tech</a></li>
                            <li ><a href="/life.html">Life</a></li>
                            <li ><a href="/note.html">Note</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><a href="/about.html">About</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="/posts/2016/04/02/reconstruction-of-pelican-blog.html"> Pelican博客结构改造  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#template-page">使用Template Page划分内容</a></li>
<li><a href="#jinja2">Jinja2模板使用</a><ul>
<li><a href="#jinja2_1">Jinja2变量作用域</a></li>
<li><a href="#jinja2_2">Jinja2把文章分类</a></li>
</ul>
</li>
<li><a href="#2016-04-03">2016-04-03更新</a></li>
<li><a href="#_1">参考资料</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
<p>最近想要在博客里写一些生活相关的东西（也就是吃喝玩乐啦），同时还希望能够比较清晰地区分开技术文章和生活文章，所以这两天就在折腾着博客内容的改造，不得不提一下，这个折腾过程中看代码的感觉真的是让我找回了一丝大二时的感觉，很爽！</p>
<p>这篇文章把一些我在改造过程中遇到的问题以及解决思路记录下来。</p>
<h3 id="template-page">使用Template Page划分内容<a class="headerlink" href="#template-page" title="Permanent link">¶</a></h3>
<p>博客的改造是希望把内容分成四块：技术、生活、笔记、琐碎。技术就是先前写的这些博文；生活记录一些小结或是感想的东西；笔记实质上是我平时针对一些具体技术记录的一些Tip，打算一并放上来；琐碎实际上就类似于微博，一些短的想法之类的。</p>
<p>按照上面的想法，在内容呈现上也就自然而然地希望每类对应一个单独的页面了，先前用过Pelican中的Page的功能来做过“关于我”的页面，但是这个功能并不能满足我的需求。因为Page对应的模板<code>page.html</code>决定了所有的页面必须得遵循一样的格式，然而，这四块内容对应的页面的格式是不同的，比如说，技术和生活的页面就只显示最近的数篇文章，而笔记页面会显示所有的，更不一样的是，琐碎页面可能会显示文章的内容而非标题。</p>
<p>因此，需要使用到Template Page的功能。这个功能用起来其实挺简单的，只需要在<code>pelicanconf.py</code>中对<code>TEMPLATE_PAGES</code>进行相关的设置即可，如下：</p>
<div class="highlight"><pre><span class="n">TEMPLATE_PAGES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'tpages/life.html'</span><span class="p">:</span> <span class="s">'life.html'</span><span class="p">,</span>
    <span class="s">'tpages/tweet.html'</span><span class="p">:</span> <span class="s">'tweet.html'</span><span class="p">,</span>
    <span class="s">'tpages/note.html'</span><span class="p">:</span> <span class="s">'note.html'</span>
<span class="p">}</span>
</pre></div>
<p>字典的键是页面的模板的路径，相对于content目录，这个模板的语法遵从是Pelican使用的Jinja2的模板引擎的规定。字典的值是生成的页面的输出路径，相对于output目录。这里只有三个页面，因为我直接修改了<code>index.html</code>这个模板，把它作为了技术文章的页面。</p>
<p>在实现这块的时候，遇到了导航栏的激活的问题。我希望把这四个页面都加入到导航栏，关于导航栏的内容，一般都在<code>base.html</code>这个模板里，对于每个页面哪个导航项该被激活，实现一般如下：</p>
<div class="highlight"><pre># 1
<span class="nt">&lt;li</span> <span class="err">{%</span> <span class="na">if</span> <span class="na">page_name =</span><span class="s">=</span> <span class="err">'</span><span class="na">categories</span><span class="err">'</span> <span class="err">%}</span> <span class="na">class=</span><span class="s">"active"</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ SITEURL }}/categories.html"</span><span class="nt">&gt;</span>Categories<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>

# 2
{% if page %}
<span class="nt">&lt;li</span> <span class="err">{%</span> <span class="na">if</span> <span class="na">page</span><span class="err">.</span><span class="na">slug =</span><span class="s">=</span> <span class="err">'</span><span class="na">about</span><span class="err">'</span> <span class="err">%}</span> <span class="na">class=</span><span class="s">"active"</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ SITEURL }}/about.html"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
{% else %}
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ SITEURL }}/about.html"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
{% endif %}
</pre></div>
<p>实现的不同是因为Pelican生成时的处理不同。我们知道，对于Jinja2这样的模板引擎来说，你除了需要给定它模板文件，还需要指定一个context，也就是你这个模板文件中使用到的变量对应的具体的值，Pelican针对不同类型的输入给定了不同的context</p>
<p>实现1用于几个特殊的模板，如<code>index.html</code>、<code>categories.html</code>、<code>tags.html</code>等，Pelican规定了每一个主题都需要提供这些模板，在调用Jinja2生成它们时，Pelican会把如<code>page_name</code>等变量传到对应的context里，所以我们可以通过判断当前页面的<code>page_name</code>来确定激活对应导航项。</p>
<p>实现2用于Page，是先前在实现“关于我”页面的时候，为该页面增加导航项的做法，之所以这样做在于我上面提到的context的问题，Pelican在Page页面的context中提供了一个<code>page</code>变量，其中包含了一系列的信息，但由于<code>base.html</code>不仅仅供Page使用，需要加个判断。类似的，Pelican在Article页面的context中提供了一个<code>article</code>变量。</p>
<p>但是，并没有办法区分两个Template Page，因为Pelican没有为它的context提供额外的信息，这点我是通过查看源代码确认的，关于它的代码在<code>generators.py</code>中，下面给出一部分，其中包含了我的修改：</p>
<div class="highlight"><pre><span class="c"># generators.py</span>
<span class="k">class</span> <span class="nc">TemplatePagesGenerator</span><span class="p">(</span><span class="n">Generator</span><span class="p">):</span>

     <span class="k">def</span> <span class="nf">generate_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>
         <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s">'TEMPLATE_PAGES'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">loaders</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_FileLoader</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
             <span class="k">try</span><span class="p">:</span>
                 <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                 <span class="n">rurls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s">'RELATIVE_URLS'</span><span class="p">]</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'tp_slug'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest</span> <span class="c"># 为TemplatePage增加slug供模板使用</span>
                 <span class="n">writer</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">rurls</span><span class="p">,</span>
                                   <span class="n">override_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
             <span class="k">finally</span><span class="p">:</span>
                 <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
             <span class="c"># 删除掉以避免影响其他的模板context</span>
             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'tp_slug'</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                 <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'tp_slug'</span><span class="p">]</span>
</pre></div>
<p>从源码中可以看到，<code>writer.write_file</code>的参数中并没有传入额外的参数，仅仅是<code>self.context</code>，我修改了代码把该变量打印了一下，发现并没有可以区分Template Page的信息，所以，改动也很简单，我自己加了一个表示slug的<code>tp_slug</code>变量到context中，这样就可以简单区分了，模板中的导航项实现如下：</p>
<div class="highlight"><pre><span class="nt">&lt;li</span> <span class="err">{%</span> <span class="na">if</span> <span class="na">tp_slug =</span><span class="s">=</span> <span class="err">'</span><span class="na">note</span><span class="err">.</span><span class="na">html</span><span class="err">'</span> <span class="err">%}</span> <span class="na">class=</span><span class="s">"active"</span><span class="err">{%</span> <span class="na">endif</span> <span class="err">%}</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ SITEURL }}/note.html"</span><span class="nt">&gt;</span>Note<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</pre></div>
<p>搞定了这个问题后，我就只需要好好的设计<code>index.html</code>、<code>life.html</code>、<code>note.html</code>以及<code>tweet.html</code>这四个分别对应四块内容的模板就行了。</p>
<h3 id="jinja2">Jinja2模板使用<a class="headerlink" href="#jinja2" title="Permanent link">¶</a></h3>
<p>在设计模板的过程中遇到了一些问题，并查到了一些解决方案，这里记录一下。</p>
<h4 id="jinja2_1">Jinja2变量作用域<a class="headerlink" href="#jinja2_1" title="Permanent link">¶</a></h4>
<p>Jinja2的变量的作用域比较奇怪，不是全局的那种，如下例子：</p>
<div class="highlight"><pre>% set last_year = 0 %}
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">article</span> <span class="k">in</span> <span class="nv">dates</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">article.category</span> <span class="k">in</span> <span class="nv">TECH_CATEGORIES</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">year</span> <span class="o">=</span> <span class="nv">article.date.strftime</span><span class="o">(</span><span class="s1">'%Y'</span><span class="o">)</span> <span class="cp">%}</span>
<span class="cp">{%</span><span class="k">if</span> <span class="nv">last_year</span> <span class="p">!</span><span class="o">=</span> <span class="nv">year</span> <span class="cp">%}</span>
<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"</span><span class="cp">{{</span><span class="nv">year</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#</span><span class="cp">{{</span><span class="nv">year</span><span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">year</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/h2&gt;</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">last_year</span> <span class="o">=</span> <span class="nv">year</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">set</span> <span class="nv">next_year</span> <span class="o">=</span> <span class="m">0</span> <span class="cp">%}</span>/<span class="cp">{%</span> <span class="k">set</span> <span class="nv">g_next_year</span> <span class="o">=</span> <span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">base</span> <span class="o">=</span> <span class="nb">loop</span><span class="nv">.index0</span> <span class="o">+</span> <span class="m">1</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">found</span> <span class="o">=</span> <span class="m">0</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">na</span> <span class="k">in</span> <span class="nv">dates</span><span class="o">[</span><span class="nv">base</span><span class="o">:]</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">found</span> <span class="o">==</span> <span class="m">0</span> <span class="k">and</span> <span class="nv">na.category</span> <span class="k">in</span> <span class="nv">TECH_CATEGORIES</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">next</span> <span class="o">=</span> <span class="nv">base</span> <span class="o">+</span> <span class="nb">loop</span><span class="nv">.index0</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">next_article</span> <span class="o">=</span> <span class="nv">dates</span><span class="o">[</span><span class="nv">next</span><span class="o">]</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">set</span> <span class="nv">next_year</span> <span class="o">=</span> <span class="nv">next_article.date.strftime</span><span class="o">(</span><span class="s1">'%Y'</span><span class="o">)</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">found</span> <span class="o">=</span> <span class="m">1</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">g_next_year.pop</span><span class="o">()</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">g_next_year.append</span><span class="o">(</span><span class="nv">next_year</span><span class="o">)</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span><span class="k">if</span> <span class="nv">next_year</span> <span class="p">!</span><span class="o">=</span> <span class="nv">year</span> <span class="cp">%}</span>/<span class="cp">{%</span> <span class="k">if</span> <span class="nv">g_next_year</span><span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="p">!</span><span class="o">=</span> <span class="nv">year</span> <span class="cp">%}</span>
<span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">"last-entry-of-year"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="nt">&lt;article&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">SITEURL</span> <span class="cp">}}</span><span class="s">/</span><span class="cp">{{</span> <span class="nv">article.url</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">article.title</span> <span class="cp">}}</span> <span class="cp">{%</span><span class="k">if</span> <span class="nv">article.subtitle</span> <span class="cp">%}</span> <span class="nt">&lt;small&gt;</span> <span class="cp">{{</span> <span class="nv">article.subtitle</span> <span class="cp">}}</span> <span class="nt">&lt;/small&gt;</span> <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span> <span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;time</span> <span class="na">pubdate=</span><span class="s">"pubdate"</span> <span class="na">datetime=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">article.date.isoformat</span><span class="o">()</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">article.locale_date</span> <span class="cp">}}</span><span class="nt">&lt;/time&gt;</span>
<span class="nt">&lt;/article&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
<p>注意我特别缩进的几行，希望达到的目的是：外部设置初值，内部改变值，再出来后检查值是否有改变。从执行过程来说，内部是会对值进行改变的，但是由于Jinja2的作用域问题，它改变的并不是外部那个变量，从而导致出来后的检查永远是未改变。</p>
<p>解决办法是<a href="http://stackoverflow.com/questions/4870346/can-a-jinja-variables-scope-extend-beyond-in-an-inner-block">使用列表</a>，貌似列表变量的作用域是全局的，所以可行，逻辑也很简单，初始化为只包含初值的列表，修改值即为弹出再插入值，然后读取值即为访问第一个元素。</p>
<h4 id="jinja2_2">Jinja2把文章分类<a class="headerlink" href="#jinja2_2" title="Permanent link">¶</a></h4>
<p>这个其实不是很通用，但还是说一下，发生在我改造<code>archives.html</code>模板的时候，希望能够把所有的文章给分一下类，然后再挨个处理。从编程的角度来看，实际上就是把一个列表拆分成四个列表嘛，在Jinja2里也是能做的，如下：</p>
<div class="highlight"><pre><span class="c">{# -- 把所有文章按大类分到不同的list中 -- #}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">tech_articles</span> <span class="o">=</span> <span class="o">[]</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">life_articles</span> <span class="o">=</span> <span class="o">[]</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">tweet_articles</span> <span class="o">=</span> <span class="o">[]</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">article</span> <span class="k">in</span> <span class="nv">dates</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">article.category</span> <span class="k">in</span> <span class="nv">TECH_CATEGORIES</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">tech_articles.append</span><span class="o">(</span><span class="nv">article</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">article.category</span> <span class="k">in</span> <span class="nv">LIFE_CATEGORIES</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">life_articles.append</span><span class="o">(</span><span class="nv">article</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">article.title</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">article.category</span> <span class="k">in</span> <span class="nv">TWEET_CATEGORIES</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">set</span> <span class="kp">_</span> <span class="o">=</span> <span class="nv">tweet_articles.append</span><span class="o">(</span><span class="nv">article</span><span class="o">)</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
<p>这里只有三个，是因为笔记类的不归档。代码里涉及到了<code>XXX_CATEGORIES</code>这样的变量，它们是我自己添加，用于对文章进行类型划分的，主要是针对一个大类下可能有不同小类的情况（比如技术类下有Python子类），在<code>pelicanconf.py</code>中添加：</p>
<div class="highlight"><pre><span class="n">TECH_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Tech'</span><span class="p">,</span> <span class="s">'Python'</span><span class="p">]</span>
<span class="n">NOTE_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Note'</span><span class="p">]</span>
<span class="n">LIFE_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Life'</span><span class="p">]</span>
<span class="n">TWEET_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Tweet'</span><span class="p">]</span>
</pre></div>
<h3 id="2016-04-03">2016-04-03更新<a class="headerlink" href="#2016-04-03" title="Permanent link">¶</a></h3>
<p>发现了一个可以替换<code>tp_slug</code>的变量<code>output_file</code>。</p>
<p>考虑再三，出于保证文章的顺序性，还是决定把琐碎部分的内容移除出，以避免它占用文章的时间线，未来可能考虑以一种非<code>article</code>的方式加入。</p>
<h3 id="_1">参考资料<a class="headerlink" href="#_1" title="Permanent link">¶</a></h3>
<ul>
<li>http://stackoverflow.com/questions/4870346/can-a-jinja-variables-scope-extend-beyond-in-an-inner-block</li>
</ul>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="/posts/2016/01/16/advanced-pelican-configuration.html" title="Previous: Pelican进阶配置">Pelican进阶配置</a></li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2016-04-02T23:43:50+08:00">Apr 2, 2016</time>
 
            <h4>Last Updated</h4>
            <div class="last_updated">2016-04-03 15:35:20+08:00</div>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#Python-ref">Python</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#Jinja2-ref">Jinja2
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#Pelican-ref">Pelican
                    <span>3</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
            $("table").addClass("table"); // Added by Goclis
        </script>

    </body>
</html>